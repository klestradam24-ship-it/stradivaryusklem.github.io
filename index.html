<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Stradivaryus Tools</title>
  <meta name="theme-color" content="#0f1420" />

  <!-- SEO b√°sico/OG (el JSON-LD lo inyecta app.js) -->
  <meta name="description" content="Cat√°logo de herramientas, proyectos y servicios en Cincinnati. Ventas, instalaci√≥n y presupuestos al instante.">

  <!-- App styles -->
  <link rel="stylesheet" href="./styles.css" />

  <!-- Manifest PWA -->
  <link rel="manifest" href="./manifest.webmanifest">

  <!-- Icono -->
  <link rel="icon" href="./icons/icon-192.png" sizes="192x192">
</head>
<body>
  <canvas id="bg" aria-hidden="true"></canvas>

  <!-- AppBar -->
  <header class="appbar">
    <div class="appbar-left">
      <img class="logo" src="logo.png" alt="Stradivaryus" />
      <div>
        <h1>Stradivaryus Tools</h1>
        <p class="tag">El Rinc√≥n de tus Herramientas</p>
      </div>
    </div>
    <div class="appbar-right">
      <button id="btnTheme" class="chip" title="Tema">üñ•Ô∏è</button>
      <button id="btnLegal" class="chip" data-go="cliente" data-subgo="legal">‚öñÔ∏è Legal</button>
      <button id="btnContactar" class="chip" data-go="cliente" data-subgo="contacto">üìû Contactar</button>
      <button id="btnLogin" class="chip" data-go="admin">üõ†Ô∏è Admin</button>
    </div>
  </header>

  <!-- Hero -->
  <section class="hero">
    <button id="hPrev" class="hnav prev" aria-label="Anterior">‚Äπ</button>
    <div class="hero-slider" id="heroSlider"></div>
    <button id="hNext" class="hnav next" aria-label="Siguiente">‚Ä∫</button>
    <div class="hero-overlay"></div>
    <div id="heroDots" class="hero-dots"></div>
  </section>

  <main>
    <!-- Barra de b√∫squeda -->
    <div class="card view-head">
      <div class="row wrap">
        <input id="searchBox" class="input" placeholder="Buscar‚Ä¶" />
        <select id="searchCat" class="input sm">
          <option value="">Todo</option>
        </select>
        <button id="btnSearch" class="btn">Buscar</button>
      </div>
      <div class="row wrap">
        <button class="chip" data-go="cliente" data-subgo="productos">üß∞ Productos</button>
        <button class="chip" data-go="cliente" data-subgo="carrito">üõí Carrito</button>
        <button class="chip" data-go="cliente" data-subgo="proyectos">üèóÔ∏è Proyectos</button>
        <button class="chip" data-go="cliente" data-subgo="contacto">üìû Contacto</button>
        <button class="chip" data-go="cliente" data-subgo="legal">‚öñÔ∏è Legal</button>
      </div>
    </div>

    <!-- Vistas ra√≠z -->
    <section id="view-cliente" class="view show">
      <!-- Subtabs -->
      <div id="subtabCliente" class="row wrap">
        <button class="chip active" data-subgo="productos">Productos</button>
        <button class="chip" data-subgo="carrito">Carrito</button>
        <button class="chip" data-subgo="proyectos">Proyectos</button>
        <button class="chip" data-subgo="contacto">Contacto</button>
        <button class="chip" data-subgo="legal">Legal</button>
      </div>

      <div id="clienteViewsMount">
        <!-- Productos -->
        <div id="view-productos" class="view show">
          <div class="grid cards" id="gridProductos"></div>
        </div>

        <!-- Carrito -->
        <div id="view-carrito" class="view">
          <div class="card">
            <h3>Tu carrito</h3>
            <ul id="listaCarrito" class="list"></ul>

            <div class="total"><span>Subtotal</span> <strong>$<span id="subTxt">0.00</span></strong></div>
            <div class="total"><span>Impuesto (<span id="taxRateTxt">0.00</span>%)</span> <strong>$<span id="taxTxt">0.00</span></strong></div>
            <div class="total"><span>Total</span> <strong>$<span id="totTxt">0.00</span></strong></div>

            <div class="row wrap" style="margin-top:10px">
              <label>Cliente:</label>
              <select id="clienteSel" class="input"></select>
              <button id="btnAddCliente" class="btn">‚ûï Registrar</button>
            </div>

            <div class="row wrap" style="margin-top:10px">
              <label>M√©todo:</label>
              <select id="metodoPago" class="input">
                <option value="">Selecciona‚Ä¶</option>
                <option value="efectivo">Efectivo</option>
                <option value="zelle">Zelle</option>
                <option value="paypal">PayPal</option>
              </select>

              <input id="montoEfectivo" class="input hidden" type="number" step="0.01" placeholder="Monto recibido" />
            </div>

            <!-- Zelle -->
            <div id="qrBox" class="row wrap hidden" style="margin-top:10px">
              <img src="qr-zelle.png" alt="QR Zelle" style="width:140px;height:auto;border-radius:12px;border:1px solid var(--line)" />
              <div class="muted">Env√≠a por Zelle y guarda el ID de transacci√≥n.</div>
            </div>

            <!-- PayPal -->
            <div id="paypalBox" class="hidden" style="margin-top:10px">
              <div id="paypalButtons"></div>
            </div>

            <div class="row" style="margin-top:12px">
              <button id="btnPagar" class="btn primary">Pagar</button>
            </div>
          </div>

          <div id="reciboBox" class="card hidden" aria-live="polite"></div>
        </div>

        <!-- Proyectos -->
        <div id="view-proyectos" class="view">
          <div class="grid cards" id="gridProyectos"></div>
        </div>

        <!-- Contacto -->
        <div id="view-contacto" class="view">
          <div class="card">
            <h3>Contacto</h3>
            <p class="muted">Tel: +1 513-379-0469 ¬∑ Email: info@stradivaryus.com</p>
            <div class="map-wrap">
              <iframe title="mapa" src="https://www.openstreetmap.org/export/embed.html?bbox=-84.55%2C39.1%2C-84.35%2C39.25&amp;layer=mapnik"
                      style="width:100%;height:300px;border:0"></iframe>
            </div>
          </div>
        </div>

        <!-- Legal -->
        <div id="view-legal" class="view">
          <div class="card legal">
            <h3>Aviso Legal</h3>
            <p class="muted">√öltima actualizaci√≥n: <span id="legalDate"></span></p>
            <details open>
              <summary>Condiciones</summary>
              <ul>
                <li>Los precios pueden cambiar sin previo aviso.</li>
                <li>Garant√≠a seg√∫n fabricante.</li>
                <li>Para devoluciones conservar recibo.</li>
              </ul>
            </details>
          </div>
        </div>
      </div>
    </section>

    <!-- ===== ADMIN ===== -->
    <section id="view-admin" class="view">
      <div id="adminGate" class="card">
        <div id="adminFirstSetup" class="">
          <h3>Configurar clave de Admin</h3>
          <div class="row wrap">
            <input id="adminNewFirst" class="input" type="password" placeholder="Nueva clave (m√≠nimo 3)" />
            <button id="adminSetFirst" class="btn primary">Guardar</button>
          </div>
          <p class="muted">Si necesitas resetear, abre <code>?resetadmin=1</code> en la URL.</p>
        </div>

        <div id="adminLoginBox" class="hidden">
          <h3>Iniciar sesi√≥n</h3>
          <div class="row wrap">
            <input id="adminPass" class="input" type="password" placeholder="Clave" />
            <button id="adminEnter" class="btn primary">Entrar</button>
          </div>
        </div>
      </div>

      <div id="adminPanel" class="hidden">
        <div class="card">
          <div class="row wrap" id="adminQuickRow">
            <div class="card mini">
              <h3>Impuestos / Clave</h3>
              <div class="row wrap">
                <label>Sales Tax %</label>
                <input id="taxInput" class="input sm" type="number" step="0.01" value="0" style="width:120px" />
                <button id="taxSave" class="btn">Guardar</button>
              </div>
              <div class="row wrap" style="margin-top:8px">
                <input id="passNew" class="input sm" type="password" placeholder="Nueva clave" />
                <button id="passSave" class="btn">Cambiar clave</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Hero admin -->
        <div class="card">
          <div class="card-head">
            <h3>Muro (Hero)</h3>
            <div class="row wrap">
              <label class="btn ghost">üì• Importar
                <input id="importHero" type="file" accept="image/*" multiple hidden />
              </label>
              <button id="clearHero" class="btn danger">Vaciar muro</button>
            </div>
          </div>
          <div id="gridHeroAdmin" class="thumbs"></div>
        </div>

        <!-- Productos admin -->
        <div class="card">
          <div class="card-head">
            <h3>Productos</h3>
            <div class="row wrap">
              <button id="addProducto" class="btn">‚ûï Nuevo</button>
              <label class="btn ghost">üì• Importar por lotes
                <input id="importProductos" type="file" accept="image/*" multiple hidden />
              </label>
            </div>
          </div>
          <div id="gridProductosAdmin" class="grid"></div>
        </div>

        <!-- Proyectos admin -->
        <div class="card">
          <div class="card-head">
            <h3>Proyectos</h3>
            <div class="row wrap">
              <button id="addProyecto" class="btn">‚ûï Nuevo</button>
              <label class="btn ghost">üì• Importar por lotes
                <input id="importProyectos" type="file" accept="image/*" multiple hidden />
              </label>
            </div>
          </div>
          <div id="gridProyectosAdmin" class="grid"></div>
        </div>

        <!-- Ventas -->
        <div class="card">
          <div class="card-head">
            <h3>Ventas</h3>
            <button id="clearVentas" class="btn danger">Borrar ventas</button>
          </div>
          <div class="table-wrap">
            <table>
              <thead>
                <tr><th>Fecha</th><th>Folio</th><th>Cliente</th><th>Items</th><th>Sub</th><th>Imp</th><th>Total</th><th>M√©todo</th><th>Impr.</th><th>Borrar</th></tr>
              </thead>
              <tbody id="tbVentas"></tbody>
            </table>
          </div>
        </div>

        <!-- Clientes -->
        <div class="card">
          <div class="card-head">
            <h3>Clientes (resumen)</h3>
            <button id="clearClientes" class="btn danger">Borrar clientes</button>
          </div>
          <div class="table-wrap">
            <table>
              <thead><tr><th>Nombre</th><th>Compras</th><th>Total</th><th>√öltima</th><th>Borrar</th></tr></thead>
              <tbody id="tbClientes"></tbody>
            </table>
          </div>
        </div>

        <div class="card">
          <div class="card-head">
            <h3>Directorio de clientes</h3>
          </div>
          <div class="table-wrap">
            <table>
              <thead><tr><th>Nombre</th><th>Tel√©fono</th><th>Empresa</th><th>Correo</th><th>Creado</th><th>Borrar</th></tr></thead>
              <tbody id="tbClientesDir"></tbody>
            </table>
          </div>
        </div>

        <!-- Presupuestos -->
        <div class="card">
          <div class="card-head">
            <h3>Presupuesto</h3>
            <div class="row wrap">
              <select id="presFormat" class="input sm">
                <option value="a4">A4</option>
                <option value="letter">Letter</option>
              </select>
              <button id="rowAdd" class="btn">‚ûï Fila</button>
              <button id="presCSV" class="btn">CSV</button>
              <button id="presPDF" class="btn primary">PDF</button>
              <button id="clearPres" class="btn danger">Borrar lista</button>
            </div>
          </div>

          <div class="row wrap" style="margin-bottom:8px">
            <input id="presCliente" class="input" placeholder="Cliente" />
            <input id="presProyecto" class="input" placeholder="Proyecto" />
          </div>

          <div class="table-wrap">
            <table id="presTable">
              <thead>
              <tr><th>Material</th><th>Cant</th><th>Precio</th><th>Subtotal</th><th></th></tr>
              </thead>
              <tbody></tbody>
              <tfoot>
              <tr><td colspan="3" style="text-align:right">Total</td><td id="presTotal">$0.00</td><td></td></tr>
              </tfoot>
            </table>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Tabs inferiores -->
  <nav class="tabbar">
    <button data-go="cliente" class="active"><span>üë§ Cliente</span></button>
    <button data-go="admin" id="tabAdmin" class="hidden"><span>üõ†Ô∏è Admin</span></button>
  </nav>

  <!-- FAB -->
  <a class="fab" href="tel:+15133790469" aria-label="Llamar">üìû</a>

  <!-- Footer -->
  <footer class="footer">¬© 2025 Stradivaryus Tools</footer>

  <!-- Lightbox -->
  <div id="lightbox" class="lightbox hidden" role="dialog" aria-modal="true">
    <div class="lb-inner">
      <button id="lbClose" class="x" aria-label="Cerrar">‚úï</button>
      <button id="lbPrev" class="nav prev" aria-label="Anterior">‚Äπ</button>
      <img id="lbImg" alt="Vista" />
      <button id="lbNext" class="nav next" aria-label="Siguiente">‚Ä∫</button>
      <div class="row tools">
        <button id="zOut" class="chip">‚àí</button>
        <button id="zReset" class="chip">100%</button>
        <button id="zIn" class="chip">Ôºã</button>
        <button id="openNew" class="chip">‚Üó Abrir</button>
      </div>
      <div class="lb-tip">Usa ‚Üê ‚Üí o clic para navegar</div>
    </div>
  </div>

  <!-- Modal -->
  <div id="modal" class="modal hidden">
    <div class="sheet" role="dialog" aria-modal="true">
      <div class="sheet-head">
        <strong id="modalTitle">Modal</strong>
        <button id="modalClose" class="x">‚úï</button>
      </div>
      <div id="modalBody" class="sheet-body"></div>
    </div>
  </div>

  <!-- SDK PayPal (puedes cambiar client-id) -->
  <script src="https://www.paypal.com/sdk/js?client-id=test&currency=USD"></script>

  <!-- jsPDF + autoTable para PDF de presupuestos -->
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.8.4/dist/jspdf.plugin.autotable.min.js"></script>

  <!-- App -->
  <script src="./app.js"></script>
</body>
</html>