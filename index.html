<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <base href="./">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Stradivaryus Tools</title>

  <!-- Fuentes -->
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"/>

  <!-- PWA -->
  <link rel="manifest" href="./manifest.webmanifest">
  <meta name="theme-color" content="#0f1420">

  <!-- iOS PWA -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Stradivaryus">
  <link rel="apple-touch-icon" href="./icons/icon-192.png"/>

  <!-- SEO/OG -->
  <meta name="description" content="Herramientas, proyectos y servicios en Cincinnati. Ventas, instalaci√≥n y presupuestos al instante.">
  <meta property="og:title" content="Stradivaryus Tools"/>
  <meta property="og:description" content="Cat√°logo de herramientas y proyectos. Presupuestos en PDF. Contacto r√°pido."/>
  <meta property="og:image" content="./og-cover.jpg"/>
  <meta property="og:type" content="website"/>
  <meta property="og:url" content="./"/>
  <meta name="twitter:card" content="summary_large_image"/>

  <link rel="icon" type="image/png" href="./icons/icon-192.png" />
  <link rel="stylesheet" href="styles.css" />

  <!-- jsPDF/AutoTable (PDF presupuestos) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js" defer></script>

  <!-- DOMPurify (sanitizado) -->
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.1.6/dist/purify.min.js"></script>

  <!-- PayPal SDK (sandbox ‚Äúsb‚Äù). Cambia client-id por el tuyo en producci√≥n -->
  <script src="https://www.paypal.com/sdk/js?client-id=sb&currency=USD" defer></script>
</head>
<body>
  <!-- Fondo animado -->
  <canvas id="bg" aria-hidden="true"></canvas>

  <!-- AppBar -->
  <header class="appbar">
    <div class="appbar-left">
      <img src="logo.png" class="logo" alt="Stradivaryus"/>
      <div>
        <h1>Stradivaryus Tools</h1>
        <p class="tag">El Rinc√≥n de tus Herramientas</p>
      </div>
    </div>
    <div class="appbar-right">
      <input id="searchBox" class="input sm" placeholder="Buscar...">
      <select id="searchCat" class="input sm">
        <option value="">Todo</option>
        <option value="productos">Productos</option>
        <option value="proyectos">Proyectos</option>
      </select>
      <button id="btnSearch" class="chip">üîé</button>
      <button id="btnTheme" class="chip" aria-label="Cambiar tema">üñ•Ô∏è</button>
      <button id="btnLegal" class="chip" aria-label="Informaci√≥n legal">‚öñÔ∏è Legal</button>
      <button id="btnContactar" class="chip">üìû Contactar</button>
      <button id="btnLogin" class="chip" data-go="admin">üõ†Ô∏è Admin</button>
    </div>
  </header>

  <!-- Hero / Muro -->
  <section id="hero" class="hero">
    <div class="hero-overlay"></div>
    <div class="hero-slider" id="heroSlider"></div>
    <div class="hero-dots" id="heroDots" aria-label="Indicadores"></div>
    <button class="hnav prev" id="hPrev" aria-label="Anterior">‚ùÆ</button>
    <button class="hnav next" id="hNext" aria-label="Siguiente">‚ùØ</button>
  </section>

  <main id="main">
    <!-- ======== CLIENTE ======== -->
    <section id="view-cliente" class="view show">
      <!-- Subtabs cliente -->
      <div id="subtabCliente" class="row wrap">
        <button class="chip active" data-subgo="productos">üß∞ Productos</button>
        <button class="chip" data-subgo="carrito">üõí Carrito</button>
        <button class="chip" data-subgo="proyectos">üèóÔ∏è Proyectos</button>
        <button class="chip" data-subgo="contacto">üìû Contacto</button>
        <button class="chip" data-subgo="legal">‚öñÔ∏è Legal</button>
      </div>

      <!-- Mount de vistas -->
      <div id="clienteViewsMount">
        <!-- Productos -->
        <section id="view-productos" class="view show">
          <div class="view-head"><h2>Herramientas</h2></div>
          <div id="gridProductos" class="grid cards"></div>
        </section>

        <!-- Carrito -->
        <section id="view-carrito" class="view">
          <div class="view-head"><h2>Carrito</h2></div>

          <div class="card">
            <div class="row wrap">
              <select id="clienteSel" class="input" aria-label="Seleccionar cliente"></select>
              <button class="chip" id="btnAddCliente">‚ûï Cliente</button>
            </div>

            <ul id="listaCarrito" class="list"></ul>

            <div class="total">
              <div>
                <div>Subtotal: $<span id="subTxt">0.00</span></div>
                <div class="muted">Sales Tax <span id="taxRateTxt">5.75</span>%: $<span id="taxTxt">0.00</span></div>
              </div>
              <strong>Total $<span id="totTxt">0.00</span></strong>
            </div>
          </div>

          <div class="card">
            <h3>Pago</h3>
            <div class="row wrap">
              <select id="metodoPago" class="input" aria-label="M√©todo de pago">
                <option value="">-- Seleccionar --</option>
                <option value="efectivo">Efectivo</option>
                <option value="zelle">Zelle</option>
                <option value="paypal">PayPal</option>
              </select>

              <input id="montoEfectivo" type="number" class="input hidden" min="0" step="0.01" placeholder="Monto entregado">
              <button id="btnPagar" class="btn primary">Pagar</button>
            </div>

            <!-- Zelle -->
            <div id="qrBox" class="qr hidden">
              <img src="qr-zelle.png" alt="QR Zelle">
              <div class="muted">Email Zelle: tuemail@zelle.com</div>
            </div>

            <!-- PayPal -->
            <div id="paypalBox" class="hidden" style="margin-top:10px;">
              <div id="paypalButtons"></div>
            </div>
          </div>

          <div id="reciboBox" class="card hidden" aria-live="polite"></div>
        </section>

        <!-- Proyectos -->
        <section id="view-proyectos" class="view">
          <div class="view-head"><h2>Proyectos</h2></div>
          <div id="gridProyectos" class="grid cards"></div>
        </section>

        <!-- Contacto -->
        <section id="view-contacto" class="view">
          <div class="view-head"><h2>Contacto</h2></div>
          <div class="card">
            <p>Para m√°s informaci√≥n:</p>
            <p><strong>Tel√©fono:</strong> <a href="tel:+15133790469">+1 513 379 0469</a></p>
            <p>Horario: L‚ÄìV ¬∑ 9:00 AM ‚Äì 5:00 PM</p>
            <p><strong>Email:</strong> <a href="mailto:info@stradivaryus.com">info@stradivaryus.com</a></p>
            <p><a href="mailto:kestradam@icloud.com">kestradam26@icloud.com</a></p>
            <div class="map-wrap" style="height:280px; border-radius:14px; overflow:hidden; border:1px solid var(--line);">
              <iframe
                src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d198858.73617515213!2d-84.69539332078124!3d39.13602445936173!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x8841b277f3d6bdf7%3A0x2a0d7b5a2d0f0db8!2sCincinnati%2C%20OH!5e0!3m2!1ses!2sus!4v1690000000000"
                width="100%" height="100%" style="border:0;" allowfullscreen loading="lazy"
                referrerpolicy="no-referrer-when-downgrade" title="Mapa de ubicaci√≥n"></iframe>
            </div>
          </div>
        </section>

        <!-- Legal -->
        <section id="view-legal" class="view">
          <div class="view-head"><h2>Informaci√≥n Legal (Ohio, EE. UU.)</h2></div>
          <div class="card">
            <p class="muted" style="margin-top:0">
              Contenido informativo basado en pr√°cticas habituales del Ohio Revised Code (ORC).
              <strong>No constituye asesor√≠a legal</strong>.
            </p>

            <details open>
              <summary><strong>T√©rminos y Condiciones</strong></summary>
              <div class="legal">
                <p><strong>Entidad:</strong> Stradivaryus Tools (‚Äúla Empresa‚Äù).
                   <strong>Jurisdicci√≥n:</strong> Ohio, EE. UU. <strong>Foro:</strong> Hamilton County.</p>
                <ul>
                  <li><strong>Precios e impuestos:</strong> USD. Sales & Use Tax conforme ORC cap. 5739.</li>
                  <li><strong>Pedidos y pago:</strong> Pedido aceptado al confirmarse el pago (efectivo, Zelle o PayPal).</li>
                  <li><strong>Garant√≠as:</strong> Las del fabricante salvo pacto escrito adicional.</li>
                  <li><strong>Responsabilidad:</strong> Limitada al monto pagado.</li>
                </ul>
              </div>
            </details>

            <details>
              <summary><strong>Privacidad</strong></summary>
              <div class="legal">
                <ul>
                  <li><strong>Datos:</strong> nombre, tel√©fono, empresa, correo.</li>
                  <li><strong>Base legal:</strong> contrato e inter√©s leg√≠timo.</li>
                  <li><strong>Conservaci√≥n:</strong> por fines contables/legales.</li>
                  <li><strong>Derechos:</strong> en <a href="mailto:info@stradivaryus.com">info@stradivaryus.com</a>.</li>
                </ul>
              </div>
            </details>

            <p class="muted">Vigencia: <span id="legalDate"></span> ¬∑ Sede: Cincinnati, Ohio</p>
          </div>
        </section>
      </div>
    </section>

    <!-- ======== ADMIN ======== -->
    <section id="view-admin" class="view">
      <div class="view-head"><h2>Panel Admin</h2></div>

      <!-- Gate / Setup -->
      <div id="adminGate" class="card">
        <div id="adminFirstSetup" class="hidden">
          <h3>Configurar contrase√±a de Admin</h3>
          <div class="row">
            <input id="adminNewFirst" type="password" class="input" placeholder="Nueva contrase√±a (m√≠n. 3)">
            <button id="adminSetFirst" class="btn primary">Guardar</button>
          </div>
        </div>

        <div id="adminLoginBox">
          <div class="row">
            <input id="adminPass" type="password" class="input" placeholder="Contrase√±a Admin">
            <button id="adminEnter" class="btn primary">Ingresar</button>
          </div>
          <p class="muted">¬øOlvidaste la clave? Abre <code>?resetadmin=1</code> en la URL para reiniciar y crear una nueva.</p>
        </div>
      </div>

      <!-- Panel -->
      <div id="adminPanel" class="hidden">
        <!-- Muro -->
        <div class="card">
          <div class="card-head">
            <h3>Muro / Portada</h3>
            <div class="row wrap">
              <label class="btn ghost">üì• Agregar im√°genes al Muro
                <input type="file" id="importHero" accept="image/*" multiple hidden>
              </label>
              <button id="clearHero" class="btn danger">Vaciar Muro</button>
            </div>
          </div>
          <div id="gridHeroAdmin" class="thumbs"></div>
          <p class="muted" style="margin-top:6px">üí° Arrastra las miniaturas para reordenar el slider.</p>
        </div>

        <!-- Productos (Admin) -->
        <div class="card">
          <div class="card-head">
            <h3>Productos (galer√≠as)</h3>
            <div class="row wrap">
              <button id="addProducto" class="btn">‚ûï Producto</button>
              <label class="btn ghost">üì• Importar im√°genes
                <input type="file" id="importProductos" accept="image/*" multiple hidden>
              </label>
            </div>
          </div>
          <div id="gridProductosAdmin" class="grid cards admin"></div>
        </div>

        <!-- Proyectos (Admin) -->
        <div class="card">
          <div class="card-head">
            <h3>Proyectos (galer√≠as)</h3>
            <div class="row wrap">
              <button id="addProyecto" class="btn">‚ûï Proyecto</button>
              <label class="btn ghost">üì• Importar im√°genes
                <input type="file" id="importProyectos" accept="image/*" multiple hidden>
              </label>
            </div>
          </div>
          <div id="gridProyectosAdmin" class="grid cards admin"></div>
        </div>

        <!-- Presupuestos -->
        <div class="card">
          <div class="card-head">
            <h3>Presupuestos (Admin)</h3>
            <div class="row wrap">
              <button class="btn" id="rowAdd">‚ûï Fila</button>
              <button class="btn" id="presCSV">‚§ì CSV</button>
              <select id="presFormat" class="input" style="max-width:140px">
                <option value="a4" selected>PDF A4</option>
                <option value="a5">PDF A5</option>
              </select>
              <button class="btn primary" id="presPDF">üìÑ PDF</button>
            </div>
          </div>

          <div class="row wrap">
            <input id="presCliente" class="input" placeholder="üë§ Cliente">
            <input id="presProyecto" class="input" placeholder="üèóÔ∏è Proyecto">
          </div>

          <div class="table-wrap">
            <table id="presTable">
              <thead><tr><th>Material</th><th>Cant</th><th>Precio</th><th>Subtotal</th><th></th></tr></thead>
              <tbody></tbody>
              <tfoot><tr><td colspan="3" style="text-align:right"><strong>Total</strong></td><td id="presTotal">$0.00</td><td></td></tr></tfoot>
            </table>
          </div>
        </div>

        <!-- Controles r√°pidos + Export/Import -->
        <div class="row wrap" id="adminQuickRow">
          <div class="card mini">
            <h3>Sales Tax</h3>
            <div class="row">
              <input id="taxInput" type="number" class="input" step="0.01" min="0" value="5.75">
              <button id="taxSave" class="btn">Guardar</button>
            </div>
          </div>

          <div class="card mini">
            <h3>Seguridad</h3>
            <div class="row">
              <input id="passNew" type="password" class="input" placeholder="Nueva clave Admin">
              <button id="passSave" class="btn">Cambiar</button>
            </div>
          </div>
          <!-- Card de sesi√≥n y de backup se inyectan por JS -->
        </div>

        <!-- Contable -->
        <div class="card">
          <div class="card-head">
            <h3>Ventas</h3>
            <div class="row"><button id="clearVentas" class="btn danger">Limpiar</button></div>
          </div>
          <div class="table-wrap">
            <table>
              <thead><tr><th>Fecha</th><th>#</th><th>Cliente</th><th>Productos</th><th>Sub</th><th>Imp</th><th>Total</th><th>M√©todo</th><th></th><th></th></tr></thead>
              <tbody id="tbVentas"></tbody>
            </table>
          </div>
        </div>

        <div class="card">
          <div class="card-head">
            <h3>Clientes (resumen compras)</h3>
            <button id="clearClientes" class="btn danger">Limpiar</button>
          </div>
          <div class="table-wrap">
            <table>
              <thead><tr><th>Cliente</th><th>Compras</th><th>Total</th><th>√öltima</th><th></th></tr></thead>
              <tbody id="tbClientes"></tbody>
            </table>
          </div>
        </div>

        <!-- Directorio de Clientes -->
        <div class="card">
          <div class="card-head"><h3>Directorio de Clientes (registrados)</h3></div>
          <div class="table-wrap">
            <table>
              <thead><tr><th>Nombre</th><th>Tel√©fono</th><th>Empresa</th><th>Email</th><th>Registrado</th><th></th></tr></thead>
              <tbody id="tbClientesDir"></tbody>
            </table>
          </div>
        </div>

        <div class="card">
          <div class="card-head">
            <h3>Presupuestos Generados</h3>
            <button id="clearPres" class="btn danger">Limpiar</button>
          </div>
          <div class="table-wrap">
            <table>
              <thead><tr><th>Fecha</th><th>Cliente</th><th>Proyecto</th><th>Monto</th><th></th><th></th></tr></thead>
              <tbody id="tbPres"></tbody>
            </table>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Tabbar -->
  <nav class="tabbar">
    <button data-go="cliente" class="active">üë§<span>Cliente</span></button>
    <button data-go="admin" id="tabAdmin">üõ†Ô∏è<span>Admin</span></button>
  </nav>

  <!-- Bot√≥n flotante de llamada (solo m√≥vil en CSS) -->
  <a href="tel:+15133790469" class="fab">üìû</a>

  <!-- Lightbox -->
  <div id="lightbox" class="lightbox hidden" aria-hidden="true">
    <div class="lb-inner">
      <button class="x" id="lbClose" aria-label="Cerrar">‚úï</button>
      <img id="lbImg" alt="Imagen seleccionada"/>
      <div class="lb-tip">Toca para ver</div>
      <div class="tools">
        <button id="zIn" class="chip">Zoom +</button>
        <button id="zOut" class="chip">Zoom ‚àí</button>
        <button id="zReset" class="chip">Reset</button>
        <button id="openNew" class="chip">Abrir</button>
      </div>
      <button class="nav prev" id="lbPrev" aria-label="Anterior">‚ùÆ</button>
      <button class="nav next" id="lbNext" aria-label="Siguiente">‚ùØ</button>
    </div>
  </div>

  <!-- Modal -->
  <div id="modal" class="modal hidden" aria-hidden="true">
    <div class="sheet">
      <div class="sheet-head">
        <h3 id="modalTitle">T√≠tulo</h3>
        <button id="modalClose" class="x" aria-label="Cerrar">‚úï</button>
      </div>
      <div id="modalBody" class="sheet-body"></div>
    </div>
  </div>

  <footer class="footer">¬© <span id="yy"></span> Stradivaryus Tools</footer>

  <script src="app.js" defer></script>
  <script>
    document.addEventListener('DOMContentLoaded', ()=> {
      const y=document.getElementById('yy');
      if(y) y.textContent=new Date().getFullYear();
    });
  </script>
</body>
</html>
